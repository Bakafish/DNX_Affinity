#
# spec file for package dnx (Version @VERSION@)
#
# Copyright (c) 2007 Intellectual Reserve, Inc.
# This file and all modifications and additions to the pristine
# package are under the same license as the package itself.
#
# Please submit bug fixes or comments via http://dnx.sourceforge.net
#
# norootforbuild
#
Name:           dnx
Version:        @VERSION@
Release:        1
License:        GPL
Autoreqprov:    on
BuildRoot:      %{_tmppath}/%{name}-%{version}-build
BuildRequires:  gcc
Group:          Productivity/Security
Summary:        Distributed Nagios eXecutor (DNX)
Url:            http://dnx.sourceforge.net
Source:         %{name}-%{version}.tar.gz

%description
The Distributed Nagios eXecutor (DNX) package provides a Nagios Event Broker
(NEB) module and a client daemon process. DNX distributes the work of Nagios
checks across a network of client nodes, thus providing significant scalability
to the Natios monitoring software package.

%prep
%setup

%build
%configure
make
make check

%install
rm -rf %{buildroot}
%makeinstall
mkdir -p $RPM_BUILD_ROOT/etc/init.d
mkdir -p $RPM_BUILD_ROOT/usr/sbin
install -m 755 etc/dnxcld.init $RPM_BUILD_ROOT/etc/init.d/dnxcld
ln -sf ../../etc/init.d/dnxcld $RPM_BUILD_ROOT/usr/sbin/rcdnxcld

%post
%{fillup_and_insserv -f dnxcld}

%preun
%stop_on_removal dnxcld

%postun
%restart_on_update dnxcld
%insserv_cleanup

%clean
rm -rf "$RPM_BUILD_ROOT"

%files
%defattr(-,root,root)
%doc AUTHORS COPYING ChangeLog NEWS README
%config /etc/init.d/dnxcld
%config /etc/dnxClient.cfg
%config /etc/dnxServer.cfg
%dir %{_libdir}/%{name}
%{_prefix}/sbin/dnxClient
%{_prefix}/sbin/rcdnxcld
%{_libdir}/%{name}/dnxServer.a
%{_libdir}/%{name}/dnxServer.la
%{_libdir}/%{name}/dnxServer.so


