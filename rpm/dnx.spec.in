#
# spec file for package dnx (Version 0.15)  
#
# Please submit bugfixes or comments via http://dnx.sourceforge.net
#
Name:           dnx
Version:        @VERSION@
Release:        1
License:        GPL
BuildRoot:      %{_tmppath}/%{name}-%{version}-build
BuildRequires:  gcc
Group:          Productivity/Security
Summary:        Distributed Nagios eXecutor (DNX)
Url:            http://dnx.sourceforge.net
Source:         %{name}-%{version}.tar.gz

%description
The Distributed Nagios eXecutor (DNX) package provides a Nagios Event Broker
(NEB) module and a client daemon process. DNX distributes the work of Nagios
checks across a network of client nodes, thus providing significant scalability
to the Natios monitoring software package.

%prep
%setup

%build
%configure
make
make check

%install
rm -rf %{buildroot}
%makeinstall
mkdir -p $RPM_BUILD_ROOT/etc/init.d
mkdir -p $RPM_BUILD_ROOT/usr/sbin
install -m 755 dnxcld.init $RPM_BUILD_ROOT/etc/init.d/dnxcld
ln -sf ../../etc/init.d/dnxcld $RPM_BUILD_ROOT/usr/sbin/rcdnxcld

%post
%{fillup_and_insserv -f dnxClient}

%preun
%stop_on_removal dnxClient

%postun
%restart_on_update dnxClient
%insserv_cleanup

%clean
rm -rf "$RPM_BUILD_ROOT"

%files
%defattr(-,root,root)
%doc AUTHORS COPYING ChangeLog NEWS README
%config /etc/init.d/dnxcld
%dir %{_libdir}/%{name}
/usr/sbin/dnxClient
/usr/sbin/rcdnxcld
%{_libdir}/dnxServer.so

